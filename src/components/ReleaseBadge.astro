---
import { Rocket } from '@lucide/astro';
---

<a
  id="releaseBadge"
  href="https://github.com/michiapp/michi/releases"
  target="_blank"
  rel="noopener noreferrer"
  class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full 
         bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700
         text-sm font-medium text-gray-700 dark:text-gray-200 
         hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
>
  <Rocket class="h-4 w-4" />
  <span id="releaseText">Fetching latest releaseâ€¦</span>
</a>

<script is:inline>
  document.addEventListener("DOMContentLoaded", async () => {
    const repo = "michiapp/michi";

    try {
      const res = await fetch(`https://api.github.com/repos/${repo}/releases/latest`);
      if (!res.ok) throw new Error("Failed to fetch release");
      const data = await res.json();

      const badge = document.getElementById("releaseBadge");
      const releaseText = document.getElementById("releaseText");

      if (badge && releaseText) {
        releaseText.textContent = `${data.tag_name} is out!`;
        badge.setAttribute("href", data.html_url);
      }
    } catch (err) {
      console.error("Error fetching release:", err);
      const releaseText = document.getElementById("releaseText");
      if (releaseText) {
        releaseText.textContent = "Could not fetch release";
      }
    }
  });
</script>
